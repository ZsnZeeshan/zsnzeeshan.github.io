<!-- Disable Google Analytics w/o consent -->
<!-- NoCookieAnalytics (always loads, cookieless, GDPR-safe) -->
<script async defer src="https://nocookieanalytics.com/latest.js"></script>

<script>
  window.nca_queue = window.nca_queue || [];
  function nca_track_safe() {
    window.nca_queue.push(arguments);
  }
</script>

<script>
  // Track the initial page view for all visitors
  nca_track_safe('page_view');
  // Track actual page path
  nca_track_safe('page_visited_' + window.location.pathname.replace(/\//g, '_'));
  // Track referrer if available
  if (document.referrer) {
    nca_track_safe('referrer_' + btoa(document.referrer));
  }

  // Track link clicks
  document.addEventListener('click', event => {
    const link = event.target.closest('a');
    if (!link) return;
    const eventName = link.dataset.event || 'link_click';
    const href = link.getAttribute('href');
    const text = link.textContent.trim();
    //console.log("Tracked link click:", { eventName, href, text });
    nca_track_safe(eventName);
  });


  // Track session time (example)
  setTimeout(() => {
    nca_track_safe('time_on_page', 30); // user stayed 30 seconds
  }, 30000);

  // Helper function for custom NoCookieAnalytics events
  function trackNCAEvent(name, value = 1) {
    if (typeof nca_track === 'function') nca_track_safe(name, value);
  }

  // Optional: helper function to track GA events if consent given
  function trackGAEvent(name, value = 1) {
    if (window.gtag && localStorage.getItem('ga_consent') === 'granted') {
      gtag('event', name, { value: value });
    }
  }
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const consentKey = "ga_consent";
  const banner = document.getElementById("cookie-consent");
  const consent = localStorage.getItem(consentKey);

  if (!consent) banner.style.display = "block";

  document.getElementById("accept-cookies").onclick = function () {
    localStorage.setItem(consentKey, "granted");
    banner.style.display = "none";
    loadGA();
  };

  if (consent === "granted") loadGA();
  // Load GA iff consent was given

  function loadGA() {
    if (window.gaLoaded) return;
    window.gaLoaded = true;

    window.dataLayer = window.dataLayer || [];
    window.gtag = function () { dataLayer.push(arguments); }
    gtag('consent', 'default', { 'analytics_storage': 'denied' });

    const s = document.createElement("script");
    s.src = "https://www.googletagmanager.com/gtag/js?id=G-3T5JF88VB0";
    s.async = true;
    document.head.appendChild(s);

    gtag('js', new Date());
    gtag('config', 'G-3T5JF88VB0', { anonymize_ip: true });
    gtag('consent', 'update', { analytics_storage: 'granted' });
  }
});

</script>
<!-- End Google Analytics with explicit consent + NoCookieAnalytics -->